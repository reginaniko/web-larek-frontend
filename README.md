# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


Описание данных
IProductItem
Интерфейс, представляющий информацию о продукте, включает следующие поля:
id: string — уникальный идентификатор продукта.
description?: string — описание продукта (необязательное поле).
image?: string — ссылка на изображение продукта (необязательное поле).
title: string — название продукта.
category?: string — категория, к которой относится продукт (необязательное поле).
price: number — цена продукта.

IAppData
Интерфейс данных для классы бизнес-логики приложения, содержит:
gallery: IProductItem[] — массив объектов продуктов, доступных в галерее.

IPaymentForm
Интерфейс для данных формы способа оплаты заказа и адреса доставки, включающий:
payment: ‘online’|’upon receipt’— выбранный способ оплаты.
address: string — адрес доставки.

IContactsForm
Интерфейс для формы оформления контактных данных для заказа, включающий:
email: string — адрес электронной почты покупателя.
phone: string — телефон покупателя.

IOrderForm 
Интерфейс, объединяющий обе формы заказа.

IOrder
Интерфейс, объединяющий свойства из IPaymentForm и IContactsForm интерфейсов, а также имеет следующие дополнительные поля:
items: string[] — массив идентификаторов продуктов в заказе.
total: number — общая стоимость заказа.

IOrderResult
Интерфейс, описывающий результат заказа:
id: string — идентификатор заказа.
total: number — общая стоимость заказа.

FormErrors
Тип, представляющий ошибки формы, где ключи соответствуют полям заказа, а значения — ошибки этих полей.

Архитектура проекта
Проект выстроен в логике MVP (Model-View-Presenter) паттерна, который разделяет ответственность между тремя основными компонентами: Model, View и Presenter.
Model: управляет данными приложения и бизнес-логикой, предоставляя интерфейс для получения и обновления данных.
View: отвечает за отображение данных пользователю и прием ввода от пользователя, но не содержит логики обработки данных.
Presenter: посредник между Model и View, который получает данные из Model, форматирует их для отображения и обновляет View. Также обрабатывает пользовательский ввод, внося изменения в Model. (Реализован непосредственно в файле index.ts)

Классы модели данных

Класс Api 
Класс предоставляет методы для выполнения HTTP-запросов к удаленному серверу, используя fetch, и обработки ответов.
constructor(baseUrl: string, options: RequestInit = {}) - принимает базовый URL для всех запросов и объект опций для настройки запросов.
Методы
get<T>(uri: string): Promise<T> - Выполняет GET-запрос по указанному uri. Возвращает Promise с данными типа T, обработанными методом handleResponse.
post<T>(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<T> - Выполняет POST-запрос (или другой метод, указанный в параметре method) по указанному uri с данными data. Возвращает Promise с данными типа T, обработанными методом handleResponse.


Базовый класс Model
Класс Model представляет собой абстрактный базовый класс, который служит основой для всех моделей данных в приложении. Он предоставляет функциональность для инициализации данных модели и управления событиями с помощью объекта IEvents.
constructor(container: HTMLElement, events: IEvents) — cоздает новый экземпляр класса Model, инициализируя его частичными данными и объектом событий.
Метод emitChanges(генерирует событие с указанным именем и необязательным payload) и isModel(проверяет, является ли переданный объект экземпляром класса Model)

AppData
Класс-модель для управления взаимодействием данных товаров и корзины, а также заказов. Наследуется от класса Model и включает свойства и методы для управления корзиной, галереей, состоянием загрузки, информацией о заказе и предварительным просмотром товаров.
Свойства: 
gallery: IProductItem[] - Массив товаров, доступных в галерее.
cart: string[] - Массив товаров, которые в настоящее время находятся в корзине.
order: IOrder - Объект, представляющий информацию о заказе, включая способ оплаты, адрес, email, телефон.
preview: string | null - Строка, представляющая ID текущего товара для предварительного просмотра, или null, если товар не выбран.
formErrors: FormErrors - Объект, содержащий ошибки валидации для форм.
Методы: 
setGallery - Устанавливает галерею с новым списком товаров.
setPreview - Устанавливает товар для предварительного просмотра по его ID.
getProducts - Возвращает текущий список товаров в галерее.
getCart - Возвращает текущий список товаров в корзине.
setOrderField и setContactsField - Устанавливают конкретное поле в форме заказа и проверяют его.
validateOrder и validateContacts - Проверяют поля формы заказа и генерируют события ошибок формы, если есть ошибки валидации.
addToCart - Добавляет товар в корзину.
getTotalPrice - Вычисляет и возвращает общую стоимость товаров в корзине.
createOrder - Собирает объект заказа для отправки на сервер.

Классы слоя представления
Класс Component
Абстрактный класс для наследования компонентами, которые будут реализовывать конкретную функциональность интерфейса.
constructor(container: HTMLElement) — конструктор, принимающий контейнер для рендеринга компонента.
toggleClass(element: HTMLElement, className: string, force?: boolean) — переключает класс элемента.
setText(element: HTMLElement, value: unknown) — устанавливает текстовое содержимое элемента.
setDisabled(element: HTMLElement, state: boolean) — устанавливает состояние блокировки элемента.
setImage(element: HTMLImageElement, src: string, alt?: string) — устанавливает изображение и альтернативный текст.
render(data?: Partial<T>): HTMLElement — рендерит компонент, принимая данные и возвращая корневой DOM-элемент.

Класс Modal
Компонент модального окна.
constructor(container: HTMLElement, events: IEvents) — конструктор, принимающий контейнер и объект событий.
Методы для управления содержимым и состоянием модального окна: set content, open, order, orderContacts, close, render.
Класс PageView
Компонент страницы галереи товаров.
constructor(container: HTMLElement, events: IEvents) — конструктор, принимающий контейнер и объект событий.
Методы для управления отображением галереи товаров, страницы и кнопки перехода в корзину товаров.

Класс Form
Класс является базовым компонентом формы с возможностью валидации, управления ошибками и обработки событий ввода. 
constructor(container: HTMLFormElement, events: IEvents) - конструктор, принимающий контейнер и объект событий.
Свойства
_submitButton, _errors (protected) - кнопка отправки формы и элемент для отображения ошибок формы.
Методы
onInputChange(field: K, value: T[K]) - обрабатывает событие изменения в поле ввода формы. Эмитирует событие orderInput:change через объект events.
isValid - устанавливает состояние кнопки отправки формы (_submitButton.disabled), основываясь на переданном значении value.
errors - устанавливает текст ошибки в элемент _errors формы.

Класс PageView 
Класс PageView представляет компонент страницы с возможностью управления счетчиком корзины, галереей изображений и блокировкой страницы. Он наследует функциональность от базового класса Component<IPage> и предоставляет методы и свойства для управления данными страницы и обработки событий.
constructor(container: HTMLElement, events: IEvents) — конструктор, принимающий контейнер и объект событий.
Свойства
_counter, _gallery, _wrapper, _cart (protected) - элементы страницы для отображения счетчика корзины, галереи изображений, обертки страницы и корзины.
Методы
counter(value: number) - устанавливает значение счетчика корзины.
gallery(items: HTMLElement[]) - устанавливает элементы галереи изображений.
locked(value: boolean) - управляет состоянием блокировки страницы. Добавляет класс page__wrapper_locked к _wrapper, если value равно true, иначе удаляет этот класс.

Класс ItemView
Класс представляет компонент для отображения элемента продукта в различных вариантах представления (компактный, детальный, галерея). Он наследует функциональность от базового класса Component<IProductItemView> и предоставляет методы и свойства для управления данными элемента продукта и обработки событий.
constructor(container: HTMLElement, events: IEvents, viewType: 'compact' | 'detail' | 'gallery')
Принимает три параметра: контейнер элемента, события и тип представления элемента продукта.

Методы
initializeView() - Инициализирует представление элемента продукта в зависимости от заданного viewType. Устанавливает соответствующие обработчики событий.
onClick(eventName: string) - Обработчик клика по элементу продукта. Эмитирует событие через объект events с уникальным идентификатором элемента продукта.
Сеттеры (id, title, category, price, image, description, index, isInCart) устанавливают соответсвующие параметры элемента
Метод disableButton используется для отключения кнопки товара, который уже находится в корзине.

Класс CartView
Компонент корзины товаров.
Наследует функциональность от базового класса Component<ICartView> и предоставляет методы и свойства для работы с элементами корзины и управления событиями.
constructor(container: HTMLElement, events: IEvents) — конструктор, принимающий контейнер и объект событий.
Свойства
_list (protected) - Элемент списка товаров в корзине.
_totalPrice (protected) - Элемент для отображения общей стоимости заказа.
_orderButton (protected) - Кнопка для оформления заказа.
Методы
items(items: HTMLElement[]) - Устанавливает элементы товаров в корзине. Если список не пустой, заменяет текущие элементы на новые. Если пустой, отображает сообщение о пустой корзине.

total(total: string) - Устанавливает общую стоимость заказа.

isButtonEnabled(value: number) - Управляет доступностью кнопки оформления заказа в зависимости от количества товаров (value <= 0).


Класс OrderView
Компонент первой формы заказа.
Представляет собой форму для оформления заказа, наследующую функциональность от базового класса Form. Он предоставляет методы и свойства для работы с полями формы, управлением событиями и выбором способа оплаты.
constructor(container: HTMLFormElement, events: IEvents) — конструктор, принимающий контейнер формы и объект событий.
Методы для управления состоянием и отображением формы: set valid, set errors, render.
Методы
handlePaymentSelection(paymentType: 'upon receipt' | 'online'): void - обработчик выбора способа оплаты, включает стиль button_alt-active для выбранного способа оплаты и отключает для остального. Вызывает метод onInputChange('payment', paymentType), чтобы обновить данные формы. Имеет метод для очиски полей ввода, вызывается при сабмите всего заказа.


Класс ContactsView
Компонент второй формы заказа. Форма для ввода контактной информации(email и телефон), наследующая функциональность от базового класса Form. 
constructor(container: HTMLFormElement, events: IEvents) - конструктор, принимающий контейнер формы и события.
Методы
Класс ContactsView наследует методы и свойства от класса Form и имеет свой метод для очиски полей ввода, вызывается при сабмите всего заказа.

OrderSuccessView
Компонент, отображающий успешное завершение заказа и количество списанных синапсов.
constructor(container: HTMLElement, events: IEvents) — конструктор, принимающий контейнер и события.
Метод orderTotal(value: number) - устанавливает текст для отображения общей суммы заказа.

Описание событий
Для работы с событиями используется EventEmitter, реализуя паттерн наблюдателя.Этот класс позволяет управлять подпиской на события, их генерацией и обработкой, уведомляя различные компоненты о произошедших изменениях или действиях. Это позволяет компонентам взаимодействовать друг с другом, не будучи напрямую связанными.В реализуемой MVP архитектуре, при изменениях в слое данных и/или в слое представления генерируются события, уведомляющие слой презентера о произошедших изменениях. 
Методы и свойства
on(eventName: EventName, callback: (data: T) => void): void - подписывает коллбэк callback на событие eventName.
off(eventName: EventName, callback: Subscriber): void - отписывает коллбэк callback от события eventName.
emit(eventName: string, data?: T): void - инициирует событие eventName, передавая данные data всем подписчикам этого события.
onAll(callback: (event: EmitterEvent) => void): void - подписывает коллбэк callback на все события.
offAll(): void - отписывает все коллбэки от всех событий.
trigger(eventName: string, context?: Partial<T>): (data: T) => void - возвращает функцию-триггер, которая при вызове эмитирует событие eventName с данными, объединенными из переданных в функцию параметров event и context.

События изменения данных
items: changed — изменение элементов в каталоге.
preview: changed — изменение предпросмотра товара.
item: click - выбор элемента в каталоге.
item: toCart — добавление товара в корзину.
item: removeCart — удаление товара из корзины.
contacts: submit — отправка готовой формы заказа.
orderInput: change - изменение состояния полей ввода форм заказа.
orderErrors: change — изменение ошибок валидации формы оплаты заказа.
contactsErrors: change — изменение ошибок валидации формы контактов заказа.

payment: changed — изменение метода оплаты.

События компонентов представления
modal: open — открытие модального окна.
modal: close — закрытие модального окна.
cart: open — открытие корзины.
order: open — открытие формы заказа.
contacts: open — открытие формы для ввода контактных данных.
success: open - открытие формы успешного оформления заказа.
success: close - закрытие формы успешного оформления заказа.